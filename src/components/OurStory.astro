---
import { Heart, Calendar, MapPin, Sparkles, BookOpen } from 'lucide-astro';

const timeline = [
  {
    date: "Spring 2016",
    title: "First Meeting",
    description: "Jackson and Mackenzie met as freshmen in high school during Health & Safety class in Mrs. Gulumgum's class. When they were assigned seats right next to each other in class, they realized that they had many things in common. They both had a love for sports and they also had many friends in common. A first connection that developed into a long-term relationship.",
    image: "/images/gallery/photo-1.jpg",
    icon: "heart"
  },
  {
    date: "May 2019",
    title: "Graduated High School",
    description: "High school was full of some great years for both of them. Lots of memories, accomplishments, school dances, and friends made over the four years at Roseville High School. By senior year, they were ready to tackle college together.",
    image: "/images/gallery/photo-2.jpg",
    icon: "calendar"
  },
  {
    date: "2019-2023",
    title: "College Days",
    description: "They went to college together at Chico State, both earning matching Psychology degrees (that they are both not using). College days consisted of many moves, adopting a dog, fun summer trips, lots of time with great friends, and trying to find any time they could to hang out between their busy college schedules.",
    image: "/images/ourstory/college.png",
    icon: "book"
  },
  {
    date: "2023-2024",
    title: "Right After College",
    description: "After graduation they set off on their own career paths, more schooling for both of them! Jackson chose to pursue fire and jump through all the hoops associated with that, while Mack chose to earn another bachelor's degree, this one in Speech Language Pathology. Different paths but always choosing each other through each new chapter.",
    image: "/images/gallery/photo-6.jpg",
    icon: "mappin"
  },
  {
    date: "May 2025",
    title: "Moving in Together",
    description: "They moved in together and learned all the things that truly matter: like who sets 12 alarms to wake up, who never seems to be able to get their trash to the trash can, and who forgets to turn off the lights...hehe.\n\nBut they also learned how great they work as a team and how much they absolutely love being around each other.",
    image: "/images/gallery/photo-5.jpg",
    icon: "mappin"
  },
  {
    date: "September 19th, 2025",
    title: "The Proposal",
    description: "After nine years of growing up together, he proposed. A total surprise at home! He distracted her while setting up a slideshow of memories, balloons, candles, flowers and Pepper by their side.\n\nThe perfect proposal, exactly how they both wanted it! She figured it was coming within the year but was completely surprised the day he decided to ask!",
    image: "/images/gallery/photo-4.jpg",
    icon: "sparkles"
  }
];

const iconMap = {
  heart: Heart,
  calendar: Calendar,
  book: BookOpen,
  mappin: MapPin,
  sparkles: Sparkles
};
---

<div class="max-w-3xl mx-auto">
  <!-- Intro -->
  <div class="text-center mb-12">
    <p class="text-lg text-[var(--color-gray)] leading-relaxed">
      A quick look at the moments that shaped their story from high school through engagement.
    </p>
  </div>
  
  <!-- Timeline -->
  <div class="relative">
    <!-- Timeline line -->
    <div class="absolute left-8 md:left-1/2 top-0 bottom-0 w-0.5 bg-[var(--color-sage-light)] transform md:-translate-x-1/2"></div>
    
    {timeline.map((item, index) => {
      const Icon = iconMap[item.icon as keyof typeof iconMap];
      const isEven = index % 2 === 0;
      
      return (
        <div class={`relative flex items-start mb-12 ${isEven ? 'md:flex-row' : 'md:flex-row-reverse'}`}>
          <!-- Icon / Thumbnail -->
          <div class="absolute left-8 md:left-1/2 transform -translate-x-1/2 z-10">
            <div class="w-20 h-20 bg-white rounded-full border-4 border-[var(--color-sage)] flex items-center justify-center overflow-hidden">
              {item.image ? (
                <button type="button" class="ourstory-thumb w-full h-full" data-img={item.image} aria-label={`Open ${item.title} photo`}>
                  <img src={item.image} alt={`${item.title} photo`} loading="lazy" class="w-full h-full object-cover" />
                </button>
              ) : (
                Icon ? <Icon class="w-6 h-6 text-[var(--color-sage-dark)]" /> : null
              )}
            </div>
          </div>
          
          <!-- Content -->
          <div class={`ml-28 md:ml-0 md:w-1/2 ${isEven ? 'md:pr-12 md:text-right' : 'md:pl-12'}`}>
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-[var(--color-sage-light)]/30">
              <span class="text-sm text-[var(--color-sage-dark)] font-medium">{item.date}</span>
              <h3 class={`text-xl font-heading text-[var(--color-charcoal)] mt-1 mb-2 flex items-center ${isEven ? 'md:justify-end md:text-right' : 'md:justify-start md:text-left'}`}>
                {isEven ? (
                  <>
                    <span class="inline-flex items-center mr-3">
                      <Icon class="w-5 h-5 text-[var(--color-sage-dark)]" />
                    </span>
                    <span>{item.title}</span>
                  </>
                ) : (
                  <>
                    <span>{item.title}</span>
                    <span class="inline-flex items-center ml-3">
                      <Icon class="w-5 h-5 text-[var(--color-sage-dark)]" />
                    </span>
                  </>
                )}
              </h3>
              <p class="text-[var(--color-gray)] text-base leading-relaxed whitespace-pre-line">{item.description}</p>
            </div>
          </div>
        </div>
      );
    })}
  </div>
  
  <!-- Closing -->
  <div class="text-center mt-8">
    <p class="text-lg font-heading text-[var(--color-sage-dark)]">
      They cannot wait to celebrate this next chapter with their friends and family.
    </p>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const thumbs = document.querySelectorAll('.ourstory-thumb');
    if (!thumbs.length) return;

    thumbs.forEach((btn) => {
      btn.addEventListener('click', (e) => {
        const src = btn.getAttribute('data-img');
        // Try to find matching gallery thumb
        const galleryImgs = document.querySelectorAll('.gallery-thumb img');
        let foundIndex = -1;
        galleryImgs.forEach((img, i) => {
          if (img.getAttribute('src') === src) foundIndex = i;
        });

        if (foundIndex >= 0) {
          // Trigger gallery button
          const galleryButtons = document.querySelectorAll('.gallery-thumb');
          galleryButtons[foundIndex]?.click();
        } else {
          // Fallback: open lightbox and set image directly if present
          const lightbox = document.getElementById('lightbox');
          const lightboxImg = document.getElementById('lightbox-img');
          const lightboxCounter = document.getElementById('lightbox-counter');
          if (lightbox && lightboxImg) {
            lightboxImg.src = src;
            lightboxImg.alt = btn.getAttribute('aria-label') || '';
            lightboxCounter.textContent = '';
            lightbox.classList.remove('hidden');
            lightbox.classList.add('flex');
            document.body.style.overflow = 'hidden';
          }
        }
      });
    });
  });
</script>
